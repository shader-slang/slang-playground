<!DOCTYPE html>
<html>

<head>
  <title>Slang Playground</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1" />
  <meta name="description"
    content="Interactive playground for experimenting with Slang shading language. Write, compile, and visualize shader code in real-time." />
  <meta name="keywords" content="Slang, shader, WebGPU, graphics programming, code playground, real-time rendering" />
  <link href="./styles/styles.css" rel="stylesheet" />
  <link rel="stylesheet" href="node_modules/jjsontree.js/dist/jsontree.js.css">
  <script src="https://unpkg.com/split-grid/dist/split-grid.js"></script>
  <script src="node_modules/requirejs/require.js"></script>
  <script src="node_modules/jjsontree.js/dist/jsontree.js"></script>
  <script>
    let RequireJS = {};
    RequireJS.require = require;
  </script>
  <script src="https://microsoft.github.io/monaco-editor/node_modules/monaco-editor/min/vs/loader.js"></script>
  <script>
    require.config({
      paths: {
        vs: "https://microsoft.github.io/monaco-editor/node_modules/monaco-editor/min/vs",
      },
    });
    window.MonacoEnvironment = { getWorkerUrl: () => proxy };
    let proxy = URL.createObjectURL(
      new Blob(
        [
          `
              self.MonacoEnvironment = {
                  baseUrl: 'https://microsoft.github.io/monaco-editor/node_modules/monaco-editor/min/'
              };
              importScripts('https://microsoft.github.io/monaco-editor/node_modules/monaco-editor/min/vs/base/worker/workerMain.js');
          `,
        ],
        { type: "text/javascript" }
      )
    );
  </script>
  <script type="module" src="util.js"></script>
  <script type="module" src="playgroundShader.js"></script>
  <script type="module" src="demos/demo-list.js"></script>
  <script type="module" src="pass_through.js"></script>
  <script type="module" src="compute.js"></script>
  <script type="module" src="compiler.js"></script>
  <script type="module" src="try-slang.js"></script>
  <script type="module" src="language-server.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TMTZVLLMBP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-TMTZVLLMBP');
  </script>
</head>

<body>
  <div id="loading-screen">
    <img height="80px" src="./static/slang-logo.svg" alt="Slang Logo" />
    <div id="loading-status-line">
      <div class="spinner"></div>
      <p class="loading-status" id="loadingStatusLabel">Loading Playground...</p>
    </div>
    <div id="progress-bar-container">
      <div id="progress-bar"></div>
    </div>
  </div>

  <div id="tooltip" class="tooltip"></div>
  <div id="contentDiv" class="mainContainer" style="display: none;">
    <div class="leftContainer" id="leftContainerDiv">
      <div class="navbar">
        <!-- Logo section -->
        <div class="navbar-logo">
          <a href="/" title="Return to home page."><img src="./static/slang-logo.svg" alt="Logo"
              class="logo-img" /></a>
        </div>

        <!-- Load Demo section -->
        <div class="navbar-actions navbar-item">
          <div class="navbar-group">
            <div class="dropdown" id="demo-dropdown">
              <select class="dropdown-select" id="demo-select" name="demo" aria-label="Load Demo">
              </select>
            </div>
          </div>
        </div>

        <!-- Run section -->
        <div class="navbar-run navbar-item">
          <button id="run-btn" disabled
            title="(F5) Compile and run the shader that provides either 'printMain' or 'imageMain'.)">&#9658;
            Run</button>
        </div>

        <!-- Entry/Compile section -->
        <div class="navbar-compile navbar-item">
          <div class="dropdown" id="target-dropdown">
            <select class="dropdown-select" id="target-select" name="target" aria-label="target">
              <option value="SPIRV">SPIR-V</option>
              <option value="HLSL">HLSL</option>
              <option value="GLSL">GLSL</option>
              <option value="METAL">METAL</option>
              <option value="WGSL">WGSL</option>
            </select>
          </div>

          <div class="dropdown" id="profile-dropdown">
            <select class="dropdown-select" id="profile-select" name="profile" aria-label="profile">
              <!-- Profile options will be populated dynamically -->
            </select>
          </div>

          <div class="dropdown" id="entrypoint-dropdown">
            <select class="dropdown-select" id="entrypoint-select" name="entrypoint" aria-label="Entrypoint">
              <option value="" disabled selected>Entrypoint</option>
            </select>
          </div>

          <button id="compile-btn" disabled
            title='(Ctrl+B) Compile the shader to the selected target. Entrypoints needs to be marked with the `[shader("stage")]` attribute.'>
            Compile
          </button>
        </div>
        <!-- Share button section -->
        <div class="navbar-standalone-button-item">
          <button class="svg-btn" id="shareButton" title="Create sharable link">
            <svg xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" viewBox="0 0 64 64" fill="currentColor">
              <path
                d="M 9 9 L 9 14 L 9 54 L 51 54 L 56 54 L 55 42 L 51 42 L 51 49.095703 L 13 50 L 13.900391 14 L 21 14 L 21 10 L 9 9 z M 44 9 L 44 17.072266 C 29.919275 17.731863 19 23.439669 19 44 L 23 44 C 23 32.732824 29.174448 25.875825 44 25.080078 L 44 33 L 56 20.5 L 44 9 z">
              </path>
            </svg>
          </button>
        </div>

        <!-- Help button section -->
        <div class="navbar-standalone-button-item">
          <button class="svg-btn" id="helpButton" title="Show Help">
            <svg xmlns="http://www.w3.org/2000/svg" width="28px" height="28px" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="feather feather-help-circle">
              <circle cx="12" cy="12" r="10" />
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
              <line x1="12" y1="17" x2="12" y2="17" />
            </svg>
          </button>
        </div>
      </div>

      <div class="workSpace" id="workSpaceDiv">
        <div class="codingSpace editorContainer" id="codeEditor"></div>
        <div class="gutter gutter-vertical" id="workSpaceGutter"></div>
        <div class="diagnosticSpace editorContainer" id="diagnostics"></div>
      </div>
    </div>
    <div class="gutter gutter-horizontal"></div>
    <div class="rightContainer" id="rightContainerDiv">
      <div class="resultSpace" id="resultSplitContainer">
        <div class="outputSpace" id="output">
          <div id="renderOutput">
            <div id="renderOverlay">
              <div id="performanceInfo"></div>
            </div>
            <canvas class="renderCanvas" id="canvas"></canvas>
          </div>
          <textarea readonly class="printSpace" id="printResult" style="display: none"></textarea>
        </div>
        <div class="gutter gutter-vertical"></div>
        <div class="codeGenSpace" id="targetResultContainer">
          <div class="codeGenHeader">
            <button class="tabButton tabButtonActive" id="btnTargetCode">Target Code</button>
            <button class="tabButton" id="btnReflection">Reflection</button>
          </div>
          <div class="targetCodeEditor editorContainer" id="codeGen"></div>
          <div class="reflectionView" id="reflectionTab" style="display: none">
            <div id="reflectionDiv" style="overflow: visible" data-jsontree-js="getReflectionJson"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="helpModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Slang Playground</h3>
        <p>
          Welcome to Slang Playground. Here you can write, compile and run Slang shaders locally within your browser.
          The Slang compiler runs locally in your browser and no data is sent to any server.
        </p>
        <h4>Compiling Shaders (the "Compile" button)</h4>
          <p>
            You can compile shaders to many targets supported by Slang here, including SPIR-V, HLSL, GLSL, Metal, and
            WGSL.
            Generating DXIL requires DXC, which doesn't run in the browser so it's not supported here.
          </p>
        <h4>Run Shaders (the "Run" button)</h4>
          <p>
            In addition to compiling shaders, this playground can also run simple shaders via WebGPU.
            The playground supports running two types of shaders:
          </p>
          <ul>
            <li><b>Image Compute Shader</b>: This is a compute shader that returns a pixel value at a given image
              coordinate, similar to ShaderToys.
              An image compute shader must define a imageMain function, see the "Circle" demo for an example.</li>
            <li><b>Print Shader</b>: This is a shader that prints text to the text output window.
              A print shader must define a printMain function, see the "Simple Print" demo for an example.</li>
          </ul>
        <h4>Shader Commands</h4>
          <p>
            WebGPU shaders in browser can use certain commands to specify how they will run.
            
            <li><code>//! @outputBuffer: ZEROS(512, 512)</code></li>
            Initialize "outputBuffer" with zeros of the provided size. Also works on Textures, but for <code>RWTexture</code>s you will need to add a <code>[format("r32f")]</code> attribute.
            <li><code>//! @myImage: URL("https://example.com/image.png")</code></li>
            Initialize "myImage" texture with image from URL.
            <li><code>//! @noiseBuffer: RAND(1000)</code></li>
            Initialize "noiseBuffer" with uniform random floats between 0 and 1.
            <li><code>//! CALL(fn-name, SIZE_OF(<resource-name>))</code></li>
            Dispatch a compute pass with the given function name and using the resource size to determine the work-group size.
            <li><code>//! CALL(fn-name, 512, 512)</code></li>
            Dispatch a compute pass with the given function name and the provided work-group size.
          </p>
        <h4>Playground functions</h4>
          <p>
            By importing the playground shader you gain access to a few helpful functions.
            <li><code>float4 getMousePosition()</code></li>
            <code>xy</code>: mouse position (in pixels) during last button down.</br>
            <code>abs(zw)</code>: mouse position during last button click.</br>
            <code>sign(mouze.z)</code>: button is down</br>
            <code>sign(mouze.w)</code>: button is clicked</br>
            <li><code>float getTime()</code></li>
            Returns the current time in milliseconds.
            <li><code>void printf<each T>(String format, expand each T values) where T : IPrintf</code></li>
            Prints the values formatted according to the format. Only available in print shaders.
          </p>
      </div>
    </div>
    <script type="module" src="ui.js"></script>
</body>

</html>